; Empty KEYS vectors are accepted by command-loop entrypoints in batch mode and
; should not publish into `recent-keys`. Non-vector KEYS should signal
; wrong-type-argument and also avoid publication.

(let ((start (length (recent-keys))))
  (progn
    (command-execute 'ignore nil [])
    (append (nthcdr start (append (recent-keys) nil)) nil)))

(let ((start (length (recent-keys))))
  (progn
    (call-interactively 'ignore nil [])
    (append (nthcdr start (append (recent-keys) nil)) nil)))

(progn
  (fset 'neo-empty-keys-probe
        (lambda ()
          (interactive)
          (list (this-command-keys)
                (this-command-keys-vector))))
  'probe-installed)

(command-execute 'neo-empty-keys-probe nil [])
(call-interactively 'neo-empty-keys-probe nil [])

(condition-case err
    (command-execute 'ignore nil "a")
  (error err))

(condition-case err
    (call-interactively 'ignore nil "a")
  (error err))

(let ((start (length (recent-keys))))
  (progn
    (condition-case _
        (command-execute 'ignore nil "a")
      (error nil))
    (append (nthcdr start (append (recent-keys) nil)) nil)))

(let ((start (length (recent-keys))))
  (progn
    (condition-case _
        (call-interactively 'ignore nil "a")
      (error nil))
    (append (nthcdr start (append (recent-keys) nil)) nil)))
