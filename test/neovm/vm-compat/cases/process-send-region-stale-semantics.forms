(with-temp-buffer
 (insert "x")
 (let ((p (start-process "neo-psr-stale" nil "cat")))
   (unwind-protect
       (progn
         (delete-process p)
         (list
          (condition-case err (process-send-region p (point-min) (point-max)) (error err))
          (condition-case err (process-send-region "neo-psr-stale" (point-min) (point-max)) (error err))
          (condition-case err (process-send-region p nil (point-max)) (error err))
          (condition-case err (process-send-region "neo-psr-stale" nil (point-max)) (error err))))
     (ignore-errors (delete-process p)))))
