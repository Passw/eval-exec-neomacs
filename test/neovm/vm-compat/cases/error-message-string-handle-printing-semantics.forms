(fboundp 'error-message-string)
(fboundp 'make-mutex)
(fboundp 'make-condition-variable)
(fboundp 'terminal-list)
(fboundp 'current-thread)
(fboundp 'selected-frame)
(fboundp 'selected-window)
(fboundp 'generate-new-buffer)
(fboundp 'kill-buffer)

(let ((msg (condition-case e
               (progn (error "%S" (make-mutex)) "")
             (error (error-message-string e)))))
  (string-prefix-p "#<mutex" msg))

(let* ((m (make-mutex))
       (cv (make-condition-variable m))
       (msg (condition-case e
                (progn (error "%S" cv) "")
              (error (error-message-string e)))))
  (string-prefix-p "#<condvar" msg))

(let* ((term (car (terminal-list)))
       (msg (condition-case e
                (progn (error "%S" term) "")
              (error (error-message-string e)))))
  (string-prefix-p "#<terminal" msg))

(let ((msg (condition-case e
               (progn (error "%S" (current-thread)) "")
             (error (error-message-string e)))))
  (string-prefix-p "#<thread" msg))

(let ((msg (condition-case e
               (progn (error "%S" (selected-frame)) "")
             (error (error-message-string e)))))
  (string-prefix-p "#<frame" msg))

(let ((msg (condition-case e
               (progn (error "%S" (selected-window)) "")
             (error (error-message-string e)))))
  (string-prefix-p "#<window" msg))

(let* ((b (generate-new-buffer "ems-handle-live"))
       (msg (condition-case e
                (progn (error "%S" b) "")
              (error (error-message-string e)))))
  (prog1
      (string-prefix-p "#<buffer " msg)
    (kill-buffer b)))

(let* ((b (generate-new-buffer "ems-handle-dead")))
  (kill-buffer b)
  (let ((msg (condition-case e
                 (progn (error "%S" b) "")
               (error (error-message-string e)))))
    (string-prefix-p "#<killed buffer" msg)))
