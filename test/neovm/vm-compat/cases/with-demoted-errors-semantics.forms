; with-demoted-errors fallback macro introspection, expansion, and runtime parity.
(fboundp 'with-demoted-errors)
(macrop 'with-demoted-errors)
(functionp 'with-demoted-errors)
(func-arity (indirect-function 'with-demoted-errors))
(macroexpand '(with-demoted-errors "DM %S" (/ 1 0)))
(macroexpand '(with-demoted-errors ("DM %S" foo) (/ 1 0)))
(condition-case err (with-demoted-errors) (error (list :error (car err) (cdr err))))
(condition-case err (with-demoted-errors "DM %S") (error (list :error (car err) (cdr err))))
(condition-case err (with-demoted-errors 1 (/ 1 0)) (error (list :error (car err) (cdr err))))
(with-demoted-errors "DM %S" (+ 1 2))
(condition-case err (with-demoted-errors "DM %S" (/ 1 0)) (error (list :error (car err) (cdr err))))
