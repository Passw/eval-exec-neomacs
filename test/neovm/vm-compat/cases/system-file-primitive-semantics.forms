; Compatibility coverage for primitive system/file helpers.
(subr-arity (symbol-function 'file-acl))
(subr-arity (symbol-function 'file-locked-p))
(subr-arity (symbol-function 'file-selinux-context))
(subr-arity (symbol-function 'file-system-info))
(subr-arity (symbol-function 'getenv-internal))
(subr-arity (symbol-function 'group-name))
(subr-arity (symbol-function 'load-average))
(subr-arity (symbol-function 'logcount))

(let ((f (make-temp-file "vm-file-acl-")))
  (prog1 (file-acl f)
    (delete-file f)))
(condition-case err (file-acl 1) (error err))

(let ((f (make-temp-file "vm-file-locked-")))
  (prog1 (file-locked-p f)
    (delete-file f)))
(condition-case err (file-locked-p 1) (error err))

(let ((f (make-temp-file "vm-file-selinux-")))
  (prog1 (file-selinux-context f)
    (delete-file f)))
(condition-case err (file-selinux-context 1) (error err))

(let ((info (file-system-info default-directory)))
  (and (listp info)
       (= (length info) 3)
       (integerp (car info))
       (integerp (car (cdr info)))
       (integerp (car (cdr (cdr info))))))
(condition-case err (file-system-info 1) (error err))

(setenv "NEOVM_COMPAT_ENV_TEST" "abc")
(getenv-internal "NEOVM_COMPAT_ENV_TEST")
(setenv "NEOVM_COMPAT_ENV_TEST")
(getenv-internal "NEOVM_COMPAT_ENV_TEST_MISSING")
(condition-case err (getenv-internal 1) (error err))

(group-name (group-gid))
(condition-case err (group-name "0") (error err))

(let ((v (load-average)))
  (and (listp v)
       (= (length v) 3)
       (integerp (car v))
       (integerp (car (cdr v)))
       (integerp (car (cdr (cdr v))))))
(let ((v (load-average t)))
  (and (listp v)
       (= (length v) 3)
       (floatp (car v))
       (floatp (car (cdr v)))
       (floatp (car (cdr (cdr v))))))
(let ((v (load-average "1")))
  (and (listp v)
       (= (length v) 3)
       (floatp (car v))
       (floatp (car (cdr v)))
       (floatp (car (cdr (cdr v))))))

(logcount 0)
(logcount 7)
(logcount -1)
(condition-case err (logcount 1.5) (error err))
