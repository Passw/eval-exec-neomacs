; NeoVM extension: argument and error contract checks for `neovm-precompile-file`.

(condition-case err (neovm-precompile-file) (error err))
(condition-case err (neovm-precompile-file "a" "b") (error err))
(condition-case err (neovm-precompile-file 42) (error err))
(condition-case err (neovm-precompile-file "/tmp/neovm-precompile-missing-source.el") (error (car err)))

(let ((err (condition-case err (neovm-precompile-file) (error err))))
  (and (eq (car err) 'wrong-number-of-arguments)
       (eq (nth 1 err) 'neovm-precompile-file)
       (= (nth 2 err) 0)))
(let ((err (condition-case err (neovm-precompile-file "a" "b") (error err))))
  (and (eq (car err) 'wrong-number-of-arguments)
       (eq (nth 1 err) 'neovm-precompile-file)
       (= (nth 2 err) 2)))
(let ((err (condition-case err (neovm-precompile-file 42) (error err))))
  (and (eq (car err) 'wrong-type-argument)
       (eq (nth 1 err) 'stringp)
       (= (nth 2 err) 42)))
(let ((err (condition-case err (neovm-precompile-file "/tmp/neovm-precompile-missing-source.el") (error err))))
  (and (eq (car err) 'file-error)
       (stringp (cadr err))
       (not (null (string-match-p "Cannot read source file for precompile" (cadr err))))
       (not (null (string-match-p "neovm-precompile-missing-source\\.el" (cadr err))))))
