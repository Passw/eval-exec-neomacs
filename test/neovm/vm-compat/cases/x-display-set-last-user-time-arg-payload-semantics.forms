; x-display-set-last-user-time should preserve current batch/no-X argument and
; payload behavior.

(condition-case err
    (x-display-set-last-user-time)
  (error (car err)))

(condition-case err
    (x-display-set-last-user-time nil 1 nil)
  (error (car err)))

(mapcar (lambda (arg)
          (condition-case err
              (x-display-set-last-user-time arg)
            (error (list (car err) (cadr err)))))
        (list nil "x" 1 'foo [foo] '(foo) '(foo . bar) (selected-frame) (car (terminal-list))))

(let ((display-args (list nil
                          "x"
                          1
                          'foo
                          [foo]
                          '(foo)
                          '(foo . bar)
                          (selected-frame)
                          (car (terminal-list))))
      (user-time-args (list 1 'foo [foo] '(foo) '(foo . bar))))
  (mapcar (lambda (display)
            (mapcar (lambda (user-time)
                      (condition-case err
                          (x-display-set-last-user-time display user-time)
                        (error (list (car err)
                                     (cadr err)
                                     (equal (nth 2 err) user-time)))))
                    user-time-args))
          display-args))

(condition-case err
    (x-display-set-last-user-time nil (selected-window))
  (error (list (car err) (cadr err) (windowp (nth 2 err)))))

(defun neovm-vm-compat-make-dead-window ()
  (let ((w (split-window)))
    (delete-window w)
    w))

(let ((w (neovm-vm-compat-make-dead-window)))
  (condition-case err
      (x-display-set-last-user-time nil w)
    (error
     (let ((msg (error-message-string err)))
       (list (car err)
             (not (null (string-match-p "frame-live-p" msg)))
             (not (null (string-match-p "#<window [0-9]+>" msg)))
             (not (null (string-match-p " on " msg))))))))
