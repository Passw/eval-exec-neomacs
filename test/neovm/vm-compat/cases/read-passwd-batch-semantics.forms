(fboundp 'read-passwd)

(condition-case err (read-passwd "pw: ") (error err))
(condition-case err (read-passwd "pw: " t) (error err))
(condition-case err (read-passwd "pw: " nil "confirm: ") (error err))

(condition-case err (read-passwd 1) (error err))
(condition-case err (read-passwd "pw: " nil 1) (error err))

(condition-case err (read-passwd) (error err))
(condition-case err (read-passwd "pw: " nil nil nil) (error err))

(condition-case err (read-passwd 'pw) (error err))
(condition-case err (read-passwd "pw: " 'confirm) (error err))
(condition-case err (read-passwd "pw: " nil 'confirm) (error err))
(condition-case err (read-passwd "pw: " nil nil nil nil) (error err))

(condition-case err (progn (setq unread-command-events '(foo . 97)) (read-passwd "")) (error (list (car err) unread-command-events)))
(condition-case err (progn (setq unread-command-events '(97 . foo)) (read-passwd "")) (error (list (car err) unread-command-events)))
(condition-case err (progn (setq unread-command-events [97]) (read-passwd "")) (error (list (car err) unread-command-events)))
(condition-case err (progn (setq unread-command-events [97 98]) (read-passwd "")) (error (list (car err) unread-command-events)))
