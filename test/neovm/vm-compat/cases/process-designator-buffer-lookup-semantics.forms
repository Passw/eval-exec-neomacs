; Process designator and buffer lookup compatibility for process primitives.
(mapcar (lambda (s)
          (list s
                (fboundp s)
                (subrp (symbol-function s))
                (subr-arity (symbol-function s))
                (commandp s)))
        '(get-buffer-process
          process-send-eof
          process-running-child-p
          process-send-region
          delete-process
          process-status
          process-exit-status
          process-name
          process-buffer))

(list
 (condition-case err (get-buffer-process) (error (car err)))
 (condition-case err (get-buffer-process nil) (error err))
 (condition-case err (get-buffer-process 'x) (error err))
 (condition-case err (get-buffer-process "__missing-neovm-buf__") (error err)))

(let ((b (get-buffer-create "neovm-gbp-test")))
  (list
   (get-buffer-process b)
   (get-buffer-process "neovm-gbp-test")
   (with-current-buffer b
     (let ((p (start-process "neovm-gbp-p" "neovm-gbp-test" "cat")))
       (unwind-protect
           (list
            (eq p (get-buffer-process b))
            (eq p (get-buffer-process "neovm-gbp-test"))
            (eq p (get-buffer-process nil))
            (eq p (process-send-eof p))
            (process-send-eof "neovm-gbp-p")
            (process-running-child-p p)
            (process-running-child-p "neovm-gbp-p")
            (condition-case err
                (process-send-region "neovm-gbp-p" (point-min) (point-max))
              (error err))
            (condition-case err
                (process-send-region nil (point-min) (point-max))
              (error err)))
         (ignore-errors (delete-process p)))))))

(condition-case err (delete-process) (error (car err)))

(with-temp-buffer
  (let ((p (start-process "neovm-dp-buf" (buffer-name (current-buffer)) "cat")))
    (unwind-protect
        (list
         (delete-process nil)
         (process-live-p p))
      (ignore-errors (delete-process p)))))

(let ((p (start-process "neovm-dp-str" nil "cat")))
  (unwind-protect
      (list
       (delete-process "neovm-dp-str")
       (process-live-p p)
       (condition-case err (delete-process "neovm-dp-str") (error err)))
    (ignore-errors (delete-process p))))

(with-temp-buffer
  (insert "x")
  (list
   (condition-case err (process-send-eof "__missing-neovm-proc__") (error err))
   (condition-case err (process-running-child-p "__missing-neovm-proc__") (error err))
   (condition-case err
       (process-send-region "__missing-neovm-proc__" (point-min) (point-max))
     (error err))
   (condition-case err
       (process-send-region 'x (point-min) (point-max))
     (error err))
   (condition-case err (delete-process 'x) (error err))
   (condition-case err (delete-process "__missing-neovm-proc__") (error err))))

(let ((p (start-process "neovm-ps" nil "cat")))
  (unwind-protect
      (list
       (process-status p)
       (process-status "neovm-ps")
       (process-status "__missing-neovm-proc__")
       (process-exit-status p)
       (process-name p)
       (process-buffer p)
       (condition-case err (process-exit-status "__missing-neovm-proc__") (error err))
       (condition-case err (process-name "__missing-neovm-proc__") (error err))
       (condition-case err (process-buffer "__missing-neovm-proc__") (error err)))
    (ignore-errors (delete-process p))))
