(fboundp 'replace-regexp-in-string)
(replace-regexp-in-string "a" "x" "a a")
(replace-regexp-in-string "a" "x" "A a")
(replace-regexp-in-string "a" "x" "A a" t)
(replace-regexp-in-string "\\(a\\)" "[\\1]" "a a")
(replace-regexp-in-string "[0-9]+" "X" "111 222 333" nil nil nil 4)
(condition-case err (replace-regexp-in-string "[a-" "x" "abc") (invalid-regexp (car err)))
(condition-case err (replace-regexp-in-string 1 "x" "abc") (error err))
(condition-case err (replace-regexp-in-string "\\([a-z]+\\)" "N" "aaa" nil nil 2 nil) (error (car err)))
(condition-case err (replace-regexp-in-string "\\(a\\)?b" "N" "b" nil nil 1 nil) (error (car err)))
(replace-regexp-in-string "\\([a-z]+\\)-\\([0-9]+\\)" "N" "aaa-111 bbb-222" nil nil 1 nil)
(condition-case err (replace-regexp-in-string "a") (wrong-number-of-arguments (car err)))
