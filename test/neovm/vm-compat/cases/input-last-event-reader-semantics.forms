(boundp 'last-command-event)
(boundp 'last-input-event)
(boundp 'last-nonmenu-event)
(list last-command-event last-input-event last-nonmenu-event)

(progn
  (setq unread-command-events (list 97))
  (read-key nil)
  (list last-command-event last-input-event last-nonmenu-event unread-command-events))

(progn
  (setq unread-command-events (list '(mouse-1)))
  (read-key nil)
  (list last-command-event last-input-event last-nonmenu-event unread-command-events))

(progn
  (setq unread-command-events (list 98))
  (read-event nil nil 0)
  (list last-command-event last-input-event last-nonmenu-event unread-command-events))

(progn
  (setq unread-command-events (list 99))
  (read-char nil nil 0)
  (list last-command-event last-input-event last-nonmenu-event unread-command-events))

(progn
  (setq unread-command-events (list 'foo))
  (condition-case _ (read-char nil nil 0) (error nil))
  (list last-command-event last-input-event last-nonmenu-event unread-command-events))

(progn
  (setq unread-command-events (list '(mouse-1) 100))
  (read-char-exclusive nil nil 0)
  (list last-command-event last-input-event last-nonmenu-event unread-command-events))

(progn
  (setq unread-command-events (list 101))
  (read-key-sequence "")
  (list last-command-event last-input-event last-nonmenu-event unread-command-events))

(progn
  (setq unread-command-events (list 102))
  (read-key-sequence-vector "")
  (list last-command-event last-input-event last-nonmenu-event unread-command-events))

; Prompt/input readers in batch preserve last-input/last-nonmenu event state
; while signaling end-of-file on queued unread events.
(let ((probes
       '((read-string "")
         (read-number "")
         (read-from-minibuffer "")
         (completing-read "" (("a") ("b")))
         (read-command "")
         (read-variable "")
         (read-buffer "")
         (read-file-name ""))))
  (mapcar
   (lambda (entry)
     (let ((fn (car entry))
           (args (cdr entry))
           (before (list last-input-event last-nonmenu-event)))
       (condition-case _
           (progn
             (setq unread-command-events (list 97 'foo))
             (apply fn args))
         (error nil))
       (list fn before (list last-input-event last-nonmenu-event) unread-command-events)))
   probes))
