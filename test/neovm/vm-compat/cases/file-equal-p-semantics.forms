; file-equal-p argument validation and file identity semantics.

(condition-case err
    (file-equal-p 1 "/tmp")
  (error err))

(condition-case err
    (file-equal-p "/tmp" 1)
  (error err))

(condition-case err
    (file-equal-p "/tmp")
  (error err))

(let* ((base (make-temp-file "neovm-file-equal-" t))
       (a (expand-file-name "a.txt" base))
       (b (expand-file-name "b.txt" base)))
  (with-temp-buffer
    (insert "a")
    (write-region nil nil a))
  (with-temp-buffer
    (insert "b")
    (write-region nil nil b))
  (prog1
      (list (file-equal-p a a)
            (file-equal-p a b)
            (file-equal-p a (expand-file-name "./a.txt" base)))
    (delete-file a)
    (delete-file b)
    (delete-directory base)))

(let* ((base (make-temp-file "neovm-file-equal-link-" t))
       (a (expand-file-name "a.txt" base))
       (l (expand-file-name "link.txt" base))
       (m (expand-file-name "missing.txt" base)))
  (with-temp-buffer
    (insert "a")
    (write-region nil nil a))
  (make-symbolic-link a l t)
  (prog1
      (list (file-equal-p a l)
            (file-equal-p l a)
            (file-equal-p a m)
            (file-equal-p m m))
    (delete-file l)
    (delete-file a)
    (delete-directory base)))

(let* ((base (make-temp-file "neovm-file-equal-eval-" t))
       (a (expand-file-name "a.txt" base)))
  (with-temp-buffer
    (insert "a")
    (write-region nil nil a))
  (prog1
      (let ((default-directory (file-name-as-directory base)))
        (file-equal-p "a.txt" "./a.txt"))
    (delete-file a)
    (delete-directory base)))
