; Process control/make/setter compatibility semantics without asynchronous kill output.
(mapcar (lambda (s)
          (list s
                (fboundp s)
                (subrp (symbol-function s))
                (subr-arity (symbol-function s))
                (commandp s)))
        '(continue-process
          interrupt-process
          kill-process
          signal-process
          stop-process
          make-process
          process-attributes
          set-process-buffer
          set-process-coding-system
          set-process-datagram-address
          set-process-inherit-coding-system-flag
          set-process-thread
          set-process-window-size))

(list
 (condition-case err (continue-process "__missing-neovm-proc__") (error err))
 (condition-case err (interrupt-process "__missing-neovm-proc__") (error err))
 (condition-case err (kill-process "__missing-neovm-proc__") (error err))
 (condition-case err (stop-process "__missing-neovm-proc__") (error err))
 (condition-case err (continue-process 'x) (error err))
 (condition-case err (interrupt-process 'x) (error err))
 (condition-case err (kill-process 'x) (error err))
 (condition-case err (stop-process 'x) (error err))
 (signal-process "__missing-neovm-proc__" 9)
 (condition-case err (signal-process 'x 9) (error err))
 (condition-case err (signal-process 1 nil) (error err))
 (condition-case err (signal-process 1 'x) (error err))
 (condition-case err (signal-process 1 "9") (error err)))

(with-temp-buffer
  (list
   (condition-case err (continue-process nil) (error (car err)))
   (condition-case err (interrupt-process nil) (error (car err)))
   (condition-case err (kill-process nil) (error (car err)))
   (condition-case err (stop-process nil) (error (car err)))
   (condition-case err (signal-process nil 9) (error (car err)))))

(list
 (signal-process (emacs-pid) 0)
 (signal-process 999999999 0)
 (signal-process "__missing-neovm-proc__" 0))

(list
 (listp (process-attributes (emacs-pid)))
 (process-attributes 999999999)
 (condition-case err (process-attributes 'x) (error err)))

(list
 (condition-case err (make-process) (error err))
 (condition-case err (make-process :foo t) (error err))
 (condition-case err (make-process :name 1) (error err))
 (condition-case err (make-process :name "neovm-mp-e1" :command 1) (error err))
 (condition-case err (make-process :name "neovm-mp-e2" :command '(1)) (error err))
 (condition-case err (make-process :name "neovm-mp-e3" :buffer 1) (error err))
 (let ((p (make-process :name "neovm-mp-ok" :command '("cat"))))
   (unwind-protect
       (processp p)
     (ignore-errors (delete-process p))))
 (let ((p (make-process :name "neovm-mp-unknown" :command '("cat") :foo t)))
   (unwind-protect
       (processp p)
     (ignore-errors (delete-process p)))))

(with-temp-buffer
  (let ((b (current-buffer))
        (p (start-process "neovm-proc-set" nil "cat")))
    (unwind-protect
        (let ((thr (current-thread)))
          (list
           (set-process-buffer p nil)
           (bufferp (set-process-buffer p b))
           (set-process-coding-system p)
           (set-process-coding-system p 'utf-8-unix)
           (set-process-datagram-address p nil)
           (set-process-inherit-coding-system-flag p t)
           (process-inherit-coding-system-flag p)
           (set-process-inherit-coding-system-flag p nil)
           (process-inherit-coding-system-flag p)
           (set-process-thread p nil)
           (threadp (set-process-thread p thr))
           (threadp (process-thread p))
           (set-process-window-size p 80 24)
           (condition-case err (set-process-thread p t) (error err))
           (condition-case err (set-process-window-size p 80 "x") (error err))
           (condition-case err (set-process-buffer p "x") (error err))))
      (ignore-errors (delete-process p)))))
