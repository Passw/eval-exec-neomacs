; x-display-set-last-user-time should keep strict frame-live-p payloads for
; USER-TIME (second argument) regardless of DISPLAY (first argument) shape.

(condition-case err
    (x-display-set-last-user-time nil nil)
  (error err))
(condition-case err
    (x-display-set-last-user-time nil 'foo)
  (error err))
(condition-case err
    (x-display-set-last-user-time nil [foo])
  (error err))
(condition-case err
    (x-display-set-last-user-time nil '(foo))
  (error err))
(condition-case err
    (x-display-set-last-user-time nil '(foo . bar))
  (error err))

(condition-case err
    (x-display-set-last-user-time "x" '(foo . bar))
  (error err))
(condition-case err
    (x-display-set-last-user-time (selected-frame) '(foo . bar))
  (error err))
(condition-case err
    (x-display-set-last-user-time (car (terminal-list)) '(foo . bar))
  (error err))

(condition-case err
    (x-display-set-last-user-time nil (selected-window))
  (error (list (car err) (cadr err) (windowp (nth 2 err)))))

(defun neovm-vm-compat-make-dead-window ()
  (let ((w (split-window)))
    (delete-window w)
    w))

(let ((w (neovm-vm-compat-make-dead-window)))
  (condition-case err
      (x-display-set-last-user-time nil w)
    (error
     (let ((msg (error-message-string err)))
       (list (car err)
             (not (null (string-match-p "frame-live-p" msg)))
             (not (null (string-match-p "#<window [0-9]+>" msg)))
             (not (null (string-match-p " on " msg))))))))
