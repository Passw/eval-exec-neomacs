(fboundp 'command-remapping)
(subr-arity (symbol-function 'command-remapping))

(let ((g (make-sparse-keymap))
      (m (make-sparse-keymap))
      (minor-mode-map-alist nil)
      (demo-mode t))
  (use-global-map g)
  (define-key m [remap ignore] 'self-insert-command)
  (setq minor-mode-map-alist (list (cons 'demo-mode m)))
  (command-remapping 'ignore))

(let ((g (make-sparse-keymap))
      (l (make-sparse-keymap))
      (m (make-sparse-keymap))
      (minor-mode-map-alist nil)
      (demo-mode t))
  (use-global-map g)
  (use-local-map l)
  (define-key m [remap ignore] 'forward-char)
  (define-key l [remap ignore] 'self-insert-command)
  (setq minor-mode-map-alist (list (cons 'demo-mode m)))
  (command-remapping 'ignore))

(let ((g (make-sparse-keymap))
      (l (make-sparse-keymap))
      (m (make-sparse-keymap))
      (minor-mode-overriding-map-alist nil)
      (minor-mode-map-alist nil)
      (demo-mode t))
  (use-global-map g)
  (use-local-map l)
  (define-key m [remap ignore] 'forward-char)
  (define-key l [remap ignore] 'self-insert-command)
  (setq minor-mode-overriding-map-alist (list (cons 'demo-mode m)))
  (setq minor-mode-map-alist (list (cons 'demo-mode l)))
  (command-remapping 'ignore))

(let ((minor-mode-map-alist '((demo-mode . 999999)))
      (demo-mode t))
  (command-remapping 'ignore))

(let ((g (make-sparse-keymap))
      (m (make-sparse-keymap))
      (minor-mode-map-alist nil)
      (demo-mode nil))
  (use-global-map g)
  (define-key g [remap ignore] 'self-insert-command)
  (define-key m [remap ignore] 'forward-char)
  (setq minor-mode-map-alist (list (cons 'demo-mode m)))
  (command-remapping 'ignore))
