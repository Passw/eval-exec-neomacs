; Command-loop KEYS argument behavior in batch mode:
; - vector KEYS are accepted
; - non-vector KEYS signal wrong-type-argument (vectorp ...)
; - KEYS do not publish into recent-keys in batch
; - this-command-keys* remain empty for KEYS-provided command dispatch in batch

(let ((start (length (recent-keys))))
  (progn
    (command-execute 'ignore nil [97 98])
    (append (nthcdr start (append (recent-keys) nil)) nil)))

(let ((start (length (recent-keys))))
  (progn
    (call-interactively 'ignore nil [97 98])
    (append (nthcdr start (append (recent-keys) nil)) nil)))

(condition-case err
    (command-execute 'ignore nil '(97 98))
  (error err))

(condition-case err
    (call-interactively 'ignore nil '(97 98))
  (error err))

(progn
  (fset 'neo-rk-loop-probe
        (lambda ()
          (interactive)
          (list (this-command-keys)
                (this-command-keys-vector))))
  'probe-installed)

(command-execute 'neo-rk-loop-probe nil [97 98])
(call-interactively 'neo-rk-loop-probe nil [99 100])
(command-execute 'neo-rk-loop-probe nil [foo])
(call-interactively 'neo-rk-loop-probe nil [bar])

(let ((start (length (recent-keys))))
  (progn
    (command-execute 'neo-rk-loop-probe nil [foo])
    (append (nthcdr start (append (recent-keys) nil)) nil)))

(let ((start (length (recent-keys))))
  (progn
    (call-interactively 'neo-rk-loop-probe nil [bar])
    (append (nthcdr start (append (recent-keys) nil)) nil)))

(let ((start (length (recent-keys))))
  (progn
    (condition-case _
        (command-execute 'ignore nil '(97 98))
      (error nil))
    (append (nthcdr start (append (recent-keys) nil)) nil)))

(let ((start (length (recent-keys))))
  (progn
    (condition-case _
        (call-interactively 'ignore nil '(97 98))
      (error nil))
    (append (nthcdr start (append (recent-keys) nil)) nil)))
