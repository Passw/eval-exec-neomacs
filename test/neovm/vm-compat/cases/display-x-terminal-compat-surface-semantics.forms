;; Newly implemented display/x/terminal compatibility surface.
(mapcar (lambda (sym)
          (list sym
                (fboundp sym)
                (subrp (symbol-function sym))
                (subr-arity (symbol-function sym))))
        '(display-grayscale-p
          display-mouse-p
          display-popup-menus-p
          display-symbol-keys-p
          terminal-parameters
          x-display-backing-store
          x-display-color-cells
          x-display-mm-height
          x-display-mm-width
          x-display-monitor-attributes-list
          x-display-planes
          x-display-save-under
          x-display-screens
          x-display-set-last-user-time
          x-display-visual-class
          x-server-input-extension-version
          x-server-vendor))

(let* ((fns '(display-grayscale-p display-mouse-p display-popup-menus-p display-symbol-keys-p))
       (term (car (terminal-list)))
       (frame (selected-frame))
       (win (selected-window)))
  (mapcar (lambda (fn)
            (list fn
                  (funcall fn)
                  (funcall fn nil)
                  (funcall fn term)
                  (funcall fn frame)
                  (condition-case err (funcall fn win) (error (car err)))
                  (condition-case err (funcall fn 1) (error (car err)))
                  (condition-case err (funcall fn "x") (error (cadr err)))
                  (condition-case err (funcall fn nil nil) (error (car err)))))
          fns))

(let* ((term (frame-terminal))
       (_ (set-terminal-parameter term 'neovm-vmcompat-terminal-parameters 99)))
  (list (assq 'neovm-vmcompat-terminal-parameters (terminal-parameters term))
        (assq 'neovm-vmcompat-terminal-parameters (terminal-parameters (selected-frame)))
        (condition-case err (terminal-parameters 1) (error (car err)))
        (condition-case err (terminal-parameters nil nil) (error (car err)))))

(let* ((fns '(x-display-backing-store
              x-display-color-cells
              x-display-mm-height
              x-display-mm-width
              x-display-monitor-attributes-list
              x-display-planes
              x-display-save-under
              x-display-screens
              x-display-visual-class
              x-server-input-extension-version
              x-server-vendor))
       (term (car (terminal-list)))
       (frame (selected-frame)))
  (mapcar (lambda (fn)
            (list fn
                  (condition-case err (funcall fn) (error err))
                  (condition-case err (funcall fn nil) (error err))
                  (condition-case err (funcall fn term) (error err))
                  (condition-case err (funcall fn frame) (error err))
                  (condition-case err (funcall fn "x") (error err))
                  (condition-case err (funcall fn 1) (error err))))
          fns))

(list (condition-case err (x-display-set-last-user-time nil) (error err))
      (condition-case err (x-display-set-last-user-time (selected-frame)) (error err))
      (condition-case err (x-display-set-last-user-time nil 1) (error err))
      (condition-case err (x-display-set-last-user-time (selected-frame) 1) (error err))
      (condition-case err (x-display-set-last-user-time "x" 1) (error err))
      (condition-case err (x-display-set-last-user-time 1 1) (error err))
      (condition-case err (x-display-set-last-user-time) (error (car err)))
      (condition-case err (x-display-set-last-user-time nil 1 nil) (error (car err))))
