; Lock in batch semantics for eval-buffer/eval-region behavior.
(with-temp-buffer
  (insert "(setq neovm-eb-a 11) (setq neovm-eb-b (+ neovm-eb-a 1))")
  (eval-buffer)
  (list neovm-eb-a neovm-eb-b))

(with-temp-buffer
  (insert "(setq neovm-eb-current-name (buffer-name))")
  (let ((target (current-buffer)))
    (with-temp-buffer
      (eval-buffer target)
      (equal (buffer-name) neovm-eb-current-name))))

(condition-case err (eval-buffer "*no-such-buffer*") (error err))
(condition-case err (eval-buffer 1) (error err))
(condition-case err (eval-buffer nil nil nil nil nil nil) (error err))

(with-temp-buffer
  (insert "(setq neovm-eb-point 1)")
  (goto-char 1)
  (eval-buffer)
  (point))

(with-temp-buffer
  (insert "(setq neovm-er-a 1) (setq neovm-er-b (+ neovm-er-a 2))")
  (eval-region 1 (point-max))
  (list neovm-er-a neovm-er-b))

(with-temp-buffer
  (insert "(setq neovm-er-reader 33)")
  (setq neovm-er-reader 0)
  (eval-region 1 (point-max) nil 'read)
  neovm-er-reader)

(with-temp-buffer
  (insert "(setq neovm-er-empty 9)")
  (setq neovm-er-empty 0)
  (eval-region nil nil)
  neovm-er-empty)

(with-temp-buffer
  (insert "(setq neovm-er-reverse 9)")
  (setq neovm-er-reverse 0)
  (eval-region (point-max) 1)
  neovm-er-reverse)

(with-temp-buffer
  (insert "(setq neovm-er-point 1)")
  (goto-char 1)
  (eval-region 1 (point-max))
  (point))

(with-temp-buffer
  (insert "(+ 1 2)")
  (condition-case err (eval-region "1" (point-max)) (error err)))

(with-temp-buffer
  (insert "(+ 1 2)")
  (condition-case err (eval-region 1 "2") (error err)))

(with-temp-buffer
  (insert "(+ 1 2)")
  (condition-case err (eval-region 1 999) (error err)))

(with-temp-buffer
  (insert "(+ 1 2)")
  (condition-case err (eval-region) (error err)))

(with-temp-buffer
  (insert "(+ 1 2)")
  (condition-case err (eval-region 1) (error err)))

(with-temp-buffer
  (insert "(+ 1 2)")
  (condition-case err (eval-region 1 (point-max) nil nil nil) (error err)))

(with-temp-buffer
  (insert "#!/usr/bin/env emacs --script")
  (insert (char-to-string 10))
  (insert "(setq neovm-eb-shebang-probe 'ok)")
  (insert (char-to-string 10))
  (eval-buffer)
  neovm-eb-shebang-probe)

(with-temp-buffer
  (insert (char-to-string 65279))
  (insert "(setq neovm-eb-bom-probe 'ok)")
  (insert (char-to-string 10))
  (condition-case err
      (progn
        (eval-buffer)
        neovm-eb-bom-probe)
    (error (car err))))

(with-temp-buffer
  (insert "#!/usr/bin/env emacs --script")
  (insert (char-to-string 10))
  (insert "(setq neovm-er-shebang-probe 'ok)")
  (insert (char-to-string 10))
  (eval-region 1 (point-max))
  neovm-er-shebang-probe)

(with-temp-buffer
  (insert (char-to-string 65279))
  (insert "(setq neovm-er-bom-probe 'ok)")
  (insert (char-to-string 10))
  (condition-case err
      (progn
        (eval-region 1 (point-max))
        neovm-er-bom-probe)
    (error (list 'error (car err)))))

(with-temp-buffer
  (insert "#!/usr/bin/env emacs --script")
  (condition-case err
      (eval-buffer)
    (error (list 'error (car err)))))

(with-temp-buffer
  (insert "#!/usr/bin/env emacs --script")
  (condition-case err
      (eval-region 1 (point-max))
    (error (list 'error (car err)))))
