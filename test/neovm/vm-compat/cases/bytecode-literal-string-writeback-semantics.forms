; Legacy `.elc` literal execution with mutating string array operations.
; Uses direct opcode subsets for aset and call-based fillarray.
(let ((s (copy-sequence "abc")))
  (funcall (car (read-from-string "#[(x y z) \"\\10\\11\\12\\111\\10\\207\" [x y z] 3]")) s 1 ?x)
  s)
(let ((s (copy-sequence "abc")))
  (funcall (car (read-from-string "#[(x y z) \"\\10\\11\\12\\111\\10\\207\" [x y z] 3]")) (prog1 s) 1 ?y)
  s)
(let* ((s (copy-sequence "abc")) (v (vector s)))
  (funcall (car (read-from-string "#[(x y z) \"\\10\\11\\12\\111\\10\\207\" [x y z] 3]")) s 1 ?x)
  (aref v 0))
(let* ((s (copy-sequence "abc")) (cell (cons s nil)))
  (funcall (car (read-from-string "#[(x y z) \"\\10\\11\\12\\111\\10\\207\" [x y z] 3]")) s 1 ?y)
  (car cell))
(let* ((s (copy-sequence "abc")) (ht (make-hash-table :test 'eq)))
  (puthash s 'v ht)
  (funcall (car (read-from-string "#[(x y z) \"\\10\\11\\12\\111\\10\\207\" [x y z] 3]")) s 1 ?x)
  (gethash s ht))
(let* ((s (copy-sequence "abc")) (ht (make-hash-table :test 'eql)))
  (puthash s 'v ht)
  (funcall (car (read-from-string "#[(x y z) \"\\10\\11\\12\\111\\10\\207\" [x y z] 3]")) s 1 ?y)
  (gethash s ht))
(let* ((s (copy-sequence "abc")) (ht (make-hash-table :test 'equal)))
  (puthash s 'v ht)
  (funcall (car (read-from-string "#[(x y z) \"\\10\\11\\12\\111\\10\\207\" [x y z] 3]")) s 1 ?z)
  (gethash s ht))
(let ((s (copy-sequence "abc")))
  (eq (funcall (car (read-from-string "#[(x y z) \"\\10\\11\\12\\111\\10\\207\" [x y z] 3]")) s 1 ?x) s))

(let ((s (copy-sequence "abc")))
  (funcall (car (read-from-string "#[(x y) \"\\302\\10\\11\\42\\10\\207\" [x y fillarray] 3]")) s ?y)
  s)
(let* ((s (copy-sequence "abc")) (v (vector s)))
  (funcall (car (read-from-string "#[(x y) \"\\302\\10\\11\\42\\10\\207\" [x y fillarray] 3]")) s ?z)
  (aref v 0))
(let* ((s (copy-sequence "abc")) (ht (make-hash-table :test 'eq)))
  (puthash s 'v ht)
  (funcall (car (read-from-string "#[(x y) \"\\302\\10\\11\\42\\10\\207\" [x y fillarray] 3]")) s ?x)
  (gethash s ht))
(let ((s (copy-sequence "abc")))
  (eq (funcall (car (read-from-string "#[(x y) \"\\302\\10\\11\\42\\10\\207\" [x y fillarray] 3]")) s ?y) s))
