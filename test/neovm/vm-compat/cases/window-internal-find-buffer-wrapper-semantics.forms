(fboundp 'delete-window-internal)
(func-arity 'delete-window-internal)
(condition-case err (delete-window-internal) (error err))
(condition-case err (delete-window-internal nil) (error err))
(condition-case err (delete-window-internal 'x) (error err))
(let ((orig (current-buffer)))
  (unwind-protect
      (let ((w (split-window)))
        (prog1
            (condition-case err (delete-window-internal w) (error err))
          (delete-other-windows-internal)))
    (set-buffer orig)))

(fboundp 'delete-other-windows-internal)
(func-arity 'delete-other-windows-internal)
(condition-case err (delete-other-windows-internal nil nil nil) (error err))
(condition-case err (delete-other-windows-internal 'x) (error err))
(let ((orig (current-buffer)))
  (unwind-protect
      (let ((w (split-window)))
        (progn
          (delete-other-windows-internal w)
          (length (window-list))))
    (set-buffer orig)))

(fboundp 'find-buffer)
(func-arity 'find-buffer)
(condition-case err (find-buffer "x" nil) (error err))
(condition-case err (find-buffer 'vm-fb-unbound-case nil) (error (car err)))
(let ((x nil))
  (bufferp (find-buffer 'x nil)))
(let ((x (current-buffer)))
  (null (find-buffer 'x nil)))
(let ((vm-fb-case 42))
  (bufferp (find-buffer 'vm-fb-case 42)))
(let ((vm-fb-case 42)
      (b (get-buffer-create " *vm-fb-case*")))
  (unwind-protect
      (progn
        (with-current-buffer b
          (setq-local vm-fb-case nil))
        (let ((r (find-buffer 'vm-fb-case nil)))
          (if (bufferp r) (buffer-name r) nil)))
    (ignore-errors (kill-buffer b))))
(let ((x (get-buffer-create " *vm-fb-dead*")))
  (kill-buffer x)
  (null (find-buffer 'x nil)))
