; interactive "e" event sourcing precedence:
;   1. command-keys context (this-command-keys-vector / KEYS arg), when non-empty
;   2. unread-command-events (first event-with-parameters, non-consuming)
;   3. last-input-event

; With empty command-keys context, "e" falls back through unread/last-input-event.
(let ((unread-command-events (list '(mouse-1))))
  (list
   (read-event)
   (this-command-keys-vector)
   (call-interactively (lambda (x) (interactive "e") x))
   (this-command-keys-vector)
   unread-command-events))
(let ((unread-command-events (list '(mouse-1))))
  (list
   (read-event)
   (this-command-keys-vector)
   (command-execute (lambda (x) (interactive "e") x))
   (this-command-keys-vector)
   unread-command-events))
(let ((unread-command-events (list 97 '(mouse-1))))
  (list
   (read-event)
   (this-command-keys-vector)
   (call-interactively (lambda (x) (interactive "e") x))
   (this-command-keys-vector)
   unread-command-events))
(let ((unread-command-events (list 97 '(mouse-1))))
  (list
   (read-event)
   (this-command-keys-vector)
   (command-execute (lambda (x) (interactive "e") x))
   (this-command-keys-vector)
   unread-command-events))
(let ((last-input-event 'mouse-1)
      (unread-command-events nil))
  (call-interactively (lambda (x) (interactive "e") x)))

; Non-empty command-keys context is authoritative, even when unread/last exist.
(let ((unread-command-events (list 97)))
  (read-key-sequence ""))
(this-command-keys-vector)
(let ((unread-command-events (list '(mouse-1))))
  (condition-case err
      (call-interactively (lambda (x) (interactive "e") x))
    (error (car err))))
(let ((unread-command-events (list '(mouse-1))))
  (condition-case err
      (call-interactively (lambda (x) (interactive "e") x) nil [])
    (error (car err))))
(let ((unread-command-events (list '(mouse-1))))
  (condition-case err
      (command-execute (lambda (x) (interactive "e") x))
    (error (car err))))

; Explicit KEYS with event objects override stale command-keys context.
(call-interactively (lambda (x) (interactive "e") x) nil (vector '(mouse-1)))
(command-execute (lambda (x) (interactive "e") x) nil (vector '(mouse-1)))
