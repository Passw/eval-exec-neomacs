; UTF-8 BOM-prefixed source should load exactly like plain source.
(progn
  (setq vm-load-bom-source "/tmp/neovm-load-bom-prefix-semantics.el")
  'ok)
(let ((orig (current-buffer))
      (buf (get-buffer-create " *vm-load-bom-src*")))
  (unwind-protect
      (progn
        (set-buffer buf)
        (erase-buffer)
        (insert (char-to-string 65279))
        (insert "(setq vm-load-bom-probe 'ok)")
        (insert (char-to-string 10))
        (insert "(setq vm-load-bom-flag t)")
        (insert (char-to-string 10))
        (write-region nil nil vm-load-bom-source nil nil))
    (set-buffer orig)
    (kill-buffer buf)))
(load vm-load-bom-source nil t)
vm-load-bom-probe
vm-load-bom-flag
(ignore-errors (delete-file vm-load-bom-source))
