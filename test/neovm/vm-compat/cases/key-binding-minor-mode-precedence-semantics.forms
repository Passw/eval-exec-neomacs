(fboundp 'key-binding)
(subr-arity (symbol-function 'key-binding))

(let ((g (make-sparse-keymap))
      (l (make-sparse-keymap))
      (m (make-sparse-keymap))
      (minor-mode-map-alist nil)
      (demo-mode t))
  (use-global-map g)
  (use-local-map l)
  (define-key g (kbd "C-a") 'beginning-of-line)
  (define-key l (kbd "C-a") 'self-insert-command)
  (define-key m (kbd "C-a") 'forward-char)
  (setq minor-mode-map-alist (list (cons 'demo-mode m)))
  (key-binding (kbd "C-a")))

(let ((g (make-sparse-keymap))
      (m-minor (make-sparse-keymap))
      (m-emu (make-sparse-keymap))
      (minor-mode-map-alist nil)
      (emulation-mode-map-alists nil)
      (minor-mode t)
      (emu-mode t))
  (use-global-map g)
  (define-key m-minor (kbd "C-a") 'self-insert-command)
  (define-key m-emu (kbd "C-a") 'forward-char)
  (setq minor-mode-map-alist (list (cons 'minor-mode m-minor)))
  (setq emulation-mode-map-alists (list (list (cons 'emu-mode m-emu))))
  (key-binding (kbd "C-a")))

(let ((g (make-sparse-keymap))
      (m-minor (make-sparse-keymap))
      (m-over (make-sparse-keymap))
      (minor-mode-map-alist nil)
      (minor-mode-overriding-map-alist nil)
      (minor-mode t))
  (use-global-map g)
  (define-key m-minor (kbd "C-a") 'self-insert-command)
  (define-key m-over (kbd "C-a") 'forward-char)
  (setq minor-mode-map-alist (list (cons 'minor-mode m-minor)))
  (setq minor-mode-overriding-map-alist (list (cons 'minor-mode m-over)))
  (key-binding (kbd "C-a")))

(let ((g (make-sparse-keymap))
      (minor-mode-map-alist '((demo-mode . 999999)))
      (demo-mode t))
  (use-global-map g)
  (define-key g (kbd "C-a") 'self-insert-command)
  (key-binding (kbd "C-a")))

(let ((g (make-sparse-keymap))
      (emulation-mode-map-alists (list (list (cons 'demo-mode 999999))))
      (demo-mode t))
  (use-global-map g)
  (define-key g (kbd "C-a") 'self-insert-command)
  (key-binding (kbd "C-a")))

(let ((g (make-sparse-keymap))
      (m-minor (make-sparse-keymap))
      (minor-mode-map-alist nil)
      (emulation-mode-map-alists nil)
      (minor-mode t))
  (use-global-map g)
  (define-key m-minor (kbd "C-a") 'self-insert-command)
  (setq minor-mode-map-alist (list (cons 'minor-mode m-minor)))
  (setq emulation-mode-map-alists '(missing-emulation-alist))
  (key-binding (kbd "C-a")))

(let ((g (make-sparse-keymap))
      (l (make-sparse-keymap))
      (minor-mode-map-alist nil)
      (demo-mode nil))
  (use-global-map g)
  (use-local-map l)
  (define-key g (kbd "C-a") 'beginning-of-line)
  (define-key l (kbd "C-a") 'self-insert-command)
  (setq minor-mode-map-alist (list (cons 'demo-mode 999999)))
  (key-binding (kbd "C-a")))
