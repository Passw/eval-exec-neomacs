; pcase-dolist fallback macro introspection, expansion, and runtime parity.
(fboundp 'pcase-dolist)
(macrop 'pcase-dolist)
(functionp 'pcase-dolist)
(autoloadp (symbol-function 'pcase-dolist))
(autoloadp (indirect-function 'pcase-dolist))
(let ((f (symbol-function 'pcase-dolist))) (list (car f) (nth 1 f) (nth 3 f) (nth 4 f)))
(let ((f (indirect-function 'pcase-dolist))) (list (car f) (nth 1 f) (nth 3 f) (nth 4 f)))
(let ((d (nth 2 (symbol-function 'pcase-dolist))))
  (list (length d)
        (string-match-p (string 10) d)
        (car (split-string d (string 10)))
        (car (cdr (split-string d (string 10))))))
(func-arity 'pcase-dolist)
(macroexpand '(pcase-dolist (x '(1 2 3)) x))
(macroexpand '(pcase-dolist (`(,k ,v) '((a 1) (b 2))) (list k v)))
(macroexpand '(pcase-dolist (x '(1 2) :done) x))
(condition-case err (macroexpand '(pcase-dolist)) (error err))
(condition-case err (macroexpand '(pcase-dolist 1)) (error err))
(condition-case err (macroexpand '(pcase-dolist (x))) (error err))
(condition-case err (macroexpand '(pcase-dolist x x)) (error err))
(condition-case err (macroexpand '(pcase-dolist (x '(1 2) . z) x)) (error err))
(let ((a (func-arity 'pcase-dolist))
      (b (condition-case err (func-arity (indirect-function 'pcase-dolist)) (error err)))
      (c (autoloadp (indirect-function 'pcase-dolist))))
  (list a b c))
(let ((acc nil))
  (pcase-dolist (x '(1 2 3))
    (setq acc (cons x acc)))
  (nreverse acc))
(let ((acc nil))
  (pcase-dolist (x '(1 2) (nreverse acc))
    (setq acc (cons x acc))))
(condition-case err (pcase-dolist (x) x) (error err))
(condition-case err (pcase-dolist (x '(1 2) :r :extra) x) (error err))
(condition-case err (pcase-dolist (x '(1) . z) x) (error err))
(condition-case err (pcase-dolist (x 1) x) (error err))
(condition-case err (pcase-dolist (x '(1 . 2)) x) (error err))
(let ((vals nil))
  (pcase-dolist (`(,a ,b) '(1 (2 3)) vals)
    (setq vals (cons (list a b) vals))))
(let ((vals nil))
  (pcase-dolist (`(,a ,b) '((1 . 2)) vals)
    (setq vals (cons (list a b) vals))))
(let ((n 0))
  (pcase-dolist ((pred numberp) '(a 1) n)
    (setq n (1+ n))))
