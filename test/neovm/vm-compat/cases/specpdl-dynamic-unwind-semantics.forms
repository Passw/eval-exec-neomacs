; Dynamic binding restoration under non-local exits and cleanup.
(let ((x 'outer))
  (progn
    (catch 'k
      (let ((x 'inner))
        (throw 'k 'done)))
    x))

(let ((x 1))
  (progn
    (catch 'k
      (let ((x 2))
        (setq x 3)
        (throw 'k nil)))
    x))

(let ((x 1))
  (condition-case nil
      (let ((x 2))
        (unwind-protect
            (error "boom")
          (setq x 3)))
    (error x)))

(let ((x 1))
  (let ((y 2))
    (condition-case nil
        (unwind-protect
            (error "boom")
          (setq x 9))
      (error x))))

(let ((trace nil))
  (condition-case nil
      (unwind-protect
          (unwind-protect
              (error "e")
            (setq trace (cons 'inner trace)))
        (setq trace (cons 'outer trace)))
    (error trace)))

(let ((err 'outer))
  (progn
    (condition-case err
        (/ 1 0)
      (arith-error err))
    err))

(let ((x 1))
  (let ((x 2))
    (condition-case err
        (/ 1 0)
      (arith-error x))))

(let ((x 1))
  (condition-case err
      (let ((x 2))
        (/ 1 0))
    (arith-error x)))

(let ((x 1))
  (progn
    (catch 'k
      (let* ((x 2)
             (y (progn (setq x 4) x)))
        (throw 'k y)))
    x))

(progn
  (defvar vm-specpdl-special 10)
  (let ((vm-specpdl-special 20))
    (funcall (lambda () vm-specpdl-special))))

(progn
  (defvar vm-specpdl-special 10)
  (let ((vm-specpdl-special 20))
    nil)
  vm-specpdl-special)

(let ((x 1))
  (condition-case nil
      (catch 'k
        (let ((x 2))
          (throw 'k 'done)))
    (error nil))
  x)

(let ((x 1))
  (condition-case nil
      (catch 'k
        (let ((x 2))
          (unwind-protect
              (throw 'k 'done)
            (setq x 3))))
    (error nil))
  x)
