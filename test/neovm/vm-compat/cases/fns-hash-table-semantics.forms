; fns.c â€” hash table introspection & sxhash operations

; hash-table-p
(hash-table-p (make-hash-table))
(hash-table-p 5)
(hash-table-p nil)
(hash-table-p '((a . 1)))

; hash-table-test
(hash-table-test (make-hash-table))
(hash-table-test (make-hash-table :test 'eq))
(hash-table-test (make-hash-table :test 'equal))
(hash-table-test (make-hash-table :test 'eql))

; hash-table-size
(>= (hash-table-size (make-hash-table :size 100)) 100)
(integerp (hash-table-size (make-hash-table)))

; hash-table-rehash-size
(floatp (hash-table-rehash-size (make-hash-table)))

; hash-table-rehash-threshold
(floatp (hash-table-rehash-threshold (make-hash-table)))

; hash-table-weakness
(hash-table-weakness (make-hash-table))
(hash-table-weakness (make-hash-table :weakness nil))

; copy-hash-table
(let ((h (make-hash-table))) (puthash 'a 1 h) (let ((h2 (copy-hash-table h))) (gethash 'a h2)))
(let ((h (make-hash-table))) (puthash 'a 1 h) (let ((h2 (copy-hash-table h))) (eq h h2)))
(let ((h (make-hash-table))) (puthash 'a 1 h) (let ((h2 (copy-hash-table h))) (hash-table-count h2)))
(let ((h (make-hash-table :test 'equal))) (puthash "key" 42 h) (let ((h2 (copy-hash-table h))) (hash-table-test h2)))

; maphash
(let ((h (make-hash-table)) (r nil)) (puthash 'a 1 h) (maphash (lambda (k v) (push (cons k v) r)) h) (length r))
(let ((h (make-hash-table)) (r 0)) (puthash 'a 1 h) (puthash 'b 2 h) (maphash (lambda (k v) (setq r (+ r v))) h) r)
(let ((h (make-hash-table))) (maphash (lambda (k v) nil) h))

; sxhash-equal
(integerp (sxhash-equal "test"))
(= (sxhash-equal "abc") (sxhash-equal "abc"))
(= (sxhash-equal '(1 2)) (sxhash-equal '(1 2)))
(integerp (sxhash-equal nil))
(integerp (sxhash-equal 42))

; sxhash-eq
(integerp (sxhash-eq 'foo))
(integerp (sxhash-eq nil))
(= (sxhash-eq 'foo) (sxhash-eq 'foo))

; sxhash-eql
(integerp (sxhash-eql 42))
(= (sxhash-eql 42) (sxhash-eql 42))
(integerp (sxhash-eql 'foo))

; sxhash-equal-including-properties
(integerp (sxhash-equal-including-properties "test"))
(= (sxhash-equal-including-properties "abc") (sxhash-equal-including-properties "abc"))

; error paths
(condition-case err (hash-table-p) (wrong-number-of-arguments (car err)))
(condition-case err (hash-table-test 5) (error (car err)))
(condition-case err (copy-hash-table 5) (error (car err)))
(condition-case err (maphash 5 (make-hash-table)) (error (car err)))
(condition-case err (maphash #'cons 5) (error (car err)))
