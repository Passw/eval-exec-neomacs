; set-file-times argument validation and mtime mutation semantics.

(condition-case err
    (set-file-times 1 nil)
  (error err))

(condition-case err
    (set-file-times)
  (error err))

(condition-case err
    (set-file-times "/tmp/neovm-set-file-times-missing" nil nil nil)
  (error err))

(let ((f (make-temp-file "neovm-set-file-times-now-")))
  (prog1
      (set-file-times f nil)
    (delete-file f)))

(let ((old (make-temp-file "neovm-set-file-times-old-"))
      (new (make-temp-file "neovm-set-file-times-new-")))
  (prog1
      (list (set-file-times old 0)
            (file-newer-than-file-p new old)
            (file-newer-than-file-p old new))
    (delete-file old)
    (delete-file new)))

(let ((f (make-temp-file "neovm-set-file-times-flag-")))
  (prog1
      (set-file-times f nil t)
    (delete-file f)))

(let* ((base (make-temp-file "neovm-set-file-times-eval-" t))
       (old (expand-file-name "old.txt" base))
       (new (expand-file-name "new.txt" base)))
  (with-temp-buffer
    (insert "old")
    (write-region nil nil old))
  (with-temp-buffer
    (insert "new")
    (write-region nil nil new))
  (prog1
      (let ((default-directory (file-name-as-directory base)))
        (list (set-file-times "old.txt" 0)
              (file-newer-than-file-p "new.txt" "old.txt")))
    (delete-file old)
    (delete-file new)
    (delete-directory base)))
