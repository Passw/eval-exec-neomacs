(fboundp 'minor-mode-key-binding)
(subr-arity (symbol-function 'minor-mode-key-binding))

(let ((m1 (make-sparse-keymap))
      (m2 (make-sparse-keymap))
      (emulation-mode-map-alists nil)
      (mode1 t)
      (mode2 t))
  (define-key m1 (kbd "C-a") #'ignore)
  (define-key m2 (kbd "C-a") #'forward-char)
  (setq emulation-mode-map-alists
        (list (list (cons 'mode1 m1))
              (list (cons 'mode2 m2))))
  (minor-mode-key-binding (kbd "C-a")))

(let ((m1 (make-sparse-keymap))
      (m2 (make-sparse-keymap))
      (emulation-mode-map-alists nil)
      (mode1 nil)
      (mode2 t))
  (define-key m1 (kbd "C-a") #'ignore)
  (define-key m2 (kbd "C-a") #'forward-char)
  (setq emulation-mode-map-alists
        (list (list (cons 'mode1 m1))
              (list (cons 'mode2 m2))))
  (minor-mode-key-binding (kbd "C-a")))

(let ((m1 (make-sparse-keymap))
      (m2 (make-sparse-keymap))
      (emulation-mode-map-alists nil)
      (mode1 t)
      (mode2 t))
  (define-key m1 (kbd "C-a") #'ignore)
  (define-key m2 (kbd "C-a") #'forward-char)
  (setq emulation-mode-map-alists
        (list (list (cons 'mode1 m1)
                    (cons 'mode2 m2))))
  (minor-mode-key-binding (kbd "C-a")))

(let ((m2 (make-sparse-keymap))
      (emulation-mode-map-alists nil)
      (emu-alist nil)
      (mode2 t))
  (define-key m2 (kbd "C-a") #'forward-char)
  (setq emu-alist (list (cons 'mode2 m2)))
  (setq emulation-mode-map-alists '(emu-alist))
  (minor-mode-key-binding (kbd "C-a")))

(let ((m2 (make-sparse-keymap))
      (emulation-mode-map-alists nil)
      (mode2 t))
  (define-key m2 (kbd "C-a") #'forward-char)
  (setq emulation-mode-map-alists
        (list 'missing-emulation-alist
              (list (cons 'mode2 m2))))
  (minor-mode-key-binding (kbd "C-a")))

(let ((m2 (make-sparse-keymap))
      (emulation-mode-map-alists nil)
      (mode1 t)
      (mode2 t))
  (define-key m2 (kbd "C-a") #'forward-char)
  (setq emulation-mode-map-alists
        (list (list (cons 'mode1 999999))
              (list (cons 'mode2 m2))))
  (condition-case err
      (minor-mode-key-binding (kbd "C-a"))
    (error err)))

(let ((m2 (make-sparse-keymap))
      (emulation-mode-map-alists nil)
      (mode1 nil)
      (mode2 t))
  (define-key m2 (kbd "C-a") #'forward-char)
  (setq emulation-mode-map-alists
        (list (list (cons 'mode1 999999))
              (list (cons 'mode2 m2))))
  (minor-mode-key-binding (kbd "C-a")))
